<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <title>Калькулятор матриц</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap');
         :root {
            --primary-color: #4A90E2;
            --secondary-color: #50E3C2;
            --background-color: #F8F9FA;
            --text-color: #333;
            --card-bg: #FFFFFF;
            --border-color: #E0E0E0;
            --error-color: #FF6B6B;
        }
        
        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            margin: 0;
            padding: 2em;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        
        .container {
            background-color: var(--card-bg);
            padding: 2.5em;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            text-align: center;
            max-width: 1000px;
            width: 100%;
            border: 1px solid var(--border-color);
        }
        
        h1 {
            color: var(--primary-color);
            font-weight: 700;
            margin-bottom: 0.5em;
            letter-spacing: 1px;
            animation: fadeInDown 1s ease-in-out;
        }
        
        p {
            color: #666;
            margin-bottom: 2em;
        }
        
        .matrix-sections {
            display: flex;
            justify-content: center;
            gap: 2em;
            flex-wrap: wrap;
        }
        
        .matrix-input {
            flex: 1;
            min-width: 300px;
            padding: 1.5em;
            border: 1px solid var(--border-color);
            border-radius: 10px;
            transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
            animation: fadeInUp 1s ease-in-out;
        }
        
        .matrix-input:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
        }
        
        h2 {
            margin-top: 0;
            color: var(--primary-color);
        }
        
        .input-group {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 1em;
            margin-bottom: 1em;
        }
        
        .input-group label {
            font-weight: 700;
        }
        
        input[type="number"] {
            width: 60px;
            padding: 0.5em;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        input[type="number"]:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(74, 144, 226, 0.2);
        }
        
        .matrix-grid {
            display: grid;
            gap: 8px;
            margin-top: 1em;
            transition: all 0.5s ease-in-out;
        }
        
        .matrix-cell {
            font-size: 1.1em;
        }
        
        .operation-buttons {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 1.5em;
            margin: 2.5em 0;
        }
        
        .operation-buttons button {
            padding: 12px 25px;
            border: none;
            border-radius: 50px;
            font-size: 1em;
            font-weight: 700;
            cursor: pointer;
            background-color: var(--primary-color);
            color: white;
            transition: transform 0.3s ease, background-color 0.3s ease, box-shadow 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        .operation-buttons button:hover {
            transform: translateY(-3px);
            background-color: #3A7BBF;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }
        
        .result-container {
            margin-top: 2em;
            padding: 1.5em;
            border-top: 2px solid var(--border-color);
            animation: fadeIn 1s;
        }
        
        #result-title {
            color: var(--secondary-color);
            font-size: 1.5em;
            animation: bounceIn 1s;
        }
        
        #error-message {
            color: var(--error-color);
            font-weight: 700;
            animation: shake 0.5s;
        }
        /* Specific animations */
        
        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes bounceIn {
            from,
            20%,
            40%,
            60%,
            80%,
            to {
                animation-timing-function: cubic-bezier(0.215, 0.61, 0.355, 1);
            }
            0% {
                opacity: 0;
                transform: scale3d(.3, .3, .3);
            }
            20% {
                transform: scale3d(1.1, 1.1, 1.1);
            }
            40% {
                transform: scale3d(.9, .9, .9);
            }
            60% {
                opacity: 1;
                transform: scale3d(1.03, 1.03, 1.03);
            }
            80% {
                transform: scale3d(.97, .97, .97);
            }
            to {
                opacity: 1;
                transform: scale3d(1, 1, 1);
            }
        }
        
        @keyframes shake {
            from,
            to {
                transform: translate3d(0, 0, 0);
            }
            10%,
            30%,
            50%,
            70%,
            90% {
                transform: translate3d(-10px, 0, 0);
            }
            20%,
            40%,
            60%,
            80% {
                transform: translate3d(10px, 0, 0);
            }
        }
    </style>
</head>

<body>

    <div class="container">
        <h1>Калькулятор матриц</h1>
        <p></p>

        <div class="matrix-sections">
            <div class="matrix-input animate__animated animate__fadeInUp">
                <h2>Матрица A</h2>
                <div class="input-group">
                    <label>Строки:</label>
                    <input type="number" id="rowsA" value="2" onchange="updateMatrices()">
                    <label>Столбцы:</label>
                    <input type="number" id="colsA" value="2" onchange="updateMatrices()">
                </div>
                <div id="matrixA-container" class="matrix-grid"></div>
            </div>

            <div class="matrix-input animate__animated animate__fadeInUp" id="matrixB-section">
                <h2>Матрица B</h2>
                <div class="input-group">
                    <label>Строки:</label>
                    <input type="number" id="rowsB" value="2" onchange="updateMatrices()">
                    <label>Столбцы:</label>
                    <input type="number" id="colsB" value="2" onchange="updateMatrices()">
                </div>
                <div id="matrixB-container" class="matrix-grid"></div>
            </div>
        </div>

        <div class="operation-buttons">
            <button onclick="performOperation('add')">Сложить (+)</button>
            <button onclick="performOperation('subtract')">Вычесть (-)</button>
            <button onclick="performOperation('multiply')">Умножить (*)</button>
            <button onclick="performOperation('inverse')">Обратная (-1)</button>
            <button onclick="performOperation('scalar_multiply')">Умножить на число (*n)</button>
            <button onclick="performOperation('transpose')">Транспонировать (t)</button>
        </div>

        <div class="result-container animate__animated animate__fadeIn" id="result-container">
            <h3 id="result-title" class="animate__animated animate__bounceIn">Результат:</h3>
            <div id="result-matrix" class="matrix-grid"></div>
            <p id="error-message" class="animate__animated animate__shake" style="color: var(--error-color);"></p>
        </div>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            updateMatrices();
        });

        function updateMatrices() {
            const rowsA = document.getElementById('rowsA').value;
            const colsA = document.getElementById('colsA').value;
            const rowsB = document.getElementById('rowsB').value;
            const colsB = document.getElementById('colsB').value;

            generateMatrixInputs('matrixA-container', rowsA, colsA);
            generateMatrixInputs('matrixB-container', rowsB, colsB);
        }

        function generateMatrixInputs(containerId, rows, cols) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            container.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;

            const numRows = parseInt(rows);
            const numCols = parseInt(cols);

            if (isNaN(numRows) || isNaN(numCols) || numRows <= 0 || numCols <= 0) {
                container.innerHTML = '<p>Введите положительные числа для строк и столбцов.</p>';
                return;
            }

            for (let i = 0; i < numRows; i++) {
                for (let j = 0; j < numCols; j++) {
                    const input = document.createElement('input');
                    input.type = 'number';
                    input.value = 0;
                    input.className = 'matrix-cell animate__animated animate__zoomIn';
                    input.dataset.row = i;
                    input.dataset.col = j;
                    container.appendChild(input);
                }
            }
        }

        async function performOperation(operation) {
            const rowsA = document.getElementById('rowsA').value;
            const colsA = document.getElementById('colsA').value;
            const matrixA = readMatrix('matrixA-container');

            const data = {
                operation: operation,
                matrixA: matrixA,
                rowsA: parseInt(rowsA),
                colsA: parseInt(colsA)
            };

            const matrixBSection = document.getElementById('matrixB-section');
            if (['add', 'subtract', 'multiply'].includes(operation)) {
                matrixBSection.style.display = 'block';
                const rowsB = document.getElementById('rowsB').value;
                const colsB = document.getElementById('colsB').value;
                const matrixB = readMatrix('matrixB-container');

                data.matrixB = matrixB;
                data.rowsB = parseInt(rowsB);
                data.colsB = parseInt(colsB);
            } else {
                matrixBSection.style.display = 'none';
            }

            if (operation === 'scalar_multiply') {
                const scalar = prompt("Введите число, на которое нужно умножить:");
                if (scalar === null || scalar.trim() === "") return;
                data.scalarN = parseFloat(scalar);
            }

            try {
                const response = await fetch('/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': getCookie('csrftoken')
                    },
                    body: JSON.stringify(data)
                });

                const resultData = await response.json();

                const resultContainer = document.getElementById('result-matrix');
                const errorMessage = document.getElementById('error-message');
                errorMessage.textContent = '';
                resultContainer.innerHTML = '';

                if (resultData.error) {
                    errorMessage.textContent = resultData.error;
                } else {
                    displayResultMatrix(resultData.result);
                }

            } catch (error) {
                console.error('Error:', error);
                document.getElementById('error-message').textContent = 'Произошла ошибка. Пожалуйста, попробуйте снова.';
            }
        }

        function readMatrix(containerId) {
            const container = document.getElementById(containerId);
            const cells = container.querySelectorAll('.matrix-cell');
            const data = [];
            cells.forEach(cell => data.push(parseFloat(cell.value)));
            return data;
        }

        function displayResultMatrix(matrix) {
            const container = document.getElementById('result-matrix');

            if (!matrix || matrix.length === 0) {
                container.textContent = 'Нет результата для отображения.';
                return;
            }

            const rows = matrix.length;
            const cols = matrix[0].length;
            container.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;

            matrix.forEach(row => {
                row.forEach(cell => {
                    const div = document.createElement('div');
                    div.textContent = parseFloat(cell).toFixed(2);
                    div.className = 'matrix-cell animate__animated animate__fadeIn';
                    container.appendChild(div);
                });
            });
        }

        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.startsWith(name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
    </script>
</body>

</html>